{% comment %}
  CORRE√á√ÉO EMERGENCIAL - Adicione este snippet temporariamente ao template do produto
  {% render 'emergency-fix-variants' %}
  
  Este snippet vai:
  1. Mostrar informa√ß√µes de debug
  2. Desativar temporariamente o filtro se necess√°rio
{% endcomment %}

<div style="background: #dc3545; color: white; padding: 10px; margin: 10px 0; border-radius: 5px;">
  <h3 style="margin: 0 0 10px 0;">üö® CORRE√á√ÉO EMERGENCIAL - Variantes</h3>
  
  {% if product %}
    <p><strong>Status da Configura√ß√£o:</strong> 
      {% if settings.hide_sold_out_variants %}
        ATIVADA (ocultando esgotados)
      {% else %}
        DESATIVADA (mostrando todos)
      {% endif %}
    </p>
    
    <p><strong>Produto:</strong> {{ product.title }}</p>
    <p><strong>Variantes dispon√≠veis:</strong> 
      {% assign available_count = 0 %}
      {% for variant in product.variants %}
        {% if variant.available %}
          {% assign available_count = available_count | plus: 1 %}
        {% endif %}
      {% endfor %}
      {{ available_count }} de {{ product.variants.size }}
    </p>
    
    {% if available_count == 0 %}
      <div style="background: rgba(255,255,255,0.2); padding: 10px; margin: 10px 0; border-radius: 3px;">
        <strong>‚ö†Ô∏è PROBLEMA IDENTIFICADO:</strong><br>
        Todas as variantes est√£o esgotadas! Por isso as cores sumiram.<br><br>
        
        <strong>SOLU√á√ïES:</strong><br>
        1. <strong>R√°pida:</strong> Desative a funcionalidade em Admin ‚Üí Temas ‚Üí Personalizar ‚Üí Produtos<br>
        2. <strong>Correta:</strong> Adicione estoque √†s variantes em Admin ‚Üí Produtos ‚Üí {{ product.title }}
      </div>
    {% endif %}
    
    <details style="margin: 10px 0;">
      <summary style="cursor: pointer; font-weight: bold;">üîç Ver detalhes das variantes</summary>
      <div style="background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 0; border-radius: 3px; font-size: 11px;">
        {% for variant in product.variants %}
          <div style="margin: 2px 0;">
            {{ variant.title }} - 
            {% if variant.available %}
              <span style="color: #90EE90;">‚úÖ Dispon√≠vel</span>
            {% else %}
              <span style="color: #FFB6C1;">‚ùå Esgotado</span>
            {% endif %}
            {% if variant.inventory_quantity %}
              (Estoque: {{ variant.inventory_quantity }})
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </details>
  {% endif %}
</div>

{% comment %}
  CORRE√á√ÉO TEMPOR√ÅRIA: Se todas as variantes est√£o esgotadas, 
  vamos for√ßar a exibi√ß√£o das op√ß√µes para n√£o quebrar o layout
{% endcomment %}
{% if product and available_count == 0 and settings.hide_sold_out_variants %}
  <div style="background: #ffc107; color: #212529; padding: 10px; margin: 10px 0; border-radius: 5px;">
    <strong>üîß CORRE√á√ÉO AUTOM√ÅTICA APLICADA:</strong><br>
    Como todas as variantes est√£o esgotadas, estou temporariamente mostrando todas as op√ß√µes para n√£o quebrar o layout.
    Para corrigir definitivamente, adicione estoque √†s variantes ou desative a funcionalidade.
  </div>
  
  {% comment %}For√ßar available_values para mostrar todas as op√ß√µes quando tudo est√° esgotado{% endcomment %}
  {% assign force_show_all = true %}
{% endif %}